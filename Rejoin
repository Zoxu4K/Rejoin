-- Fish It Auto Rejoin Utility (Fixed Version)
-- Compatible with Delta Executor
-- Bypass Error Code 773

local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local HttpService = game:GetService("HttpService")

-- Konfigurasi
local REJOIN_INTERVAL = 180 -- 3 menit (180 detik) - lebih aman
local AUTO_EXECUTE = true

-- Fungsi untuk rejoin dengan metode alternatif
local function rejoinGame()
    local success, err = pcall(function()
        print("[Fish It Utility] Preparing to rejoin...")
        
        -- Metode 1: Hop ke server lain (bypass restriction)
        local serverList = {}
        local cursor = ""
        
        repeat
            local servers = game:HttpGet(string.format(
                "https://games.roblox.com/v1/games/%s/servers/Public?sortOrder=Asc&limit=100&cursor=%s",
                game.PlaceId,
                cursor
            ))
            
            local decoded = HttpService:JSONDecode(servers)
            
            for _, server in pairs(decoded.data) do
                if server.playing < server.maxPlayers and server.id ~= game.JobId then
                    table.insert(serverList, server.id)
                end
            end
            
            cursor = decoded.nextPageCursor or ""
        until cursor == "" or #serverList >= 10
        
        if #serverList > 0 then
            local randomServer = serverList[math.random(1, #serverList)]
            print("[Fish It Utility] Hopping to different server...")
            TeleportService:TeleportToPlaceInstance(game.PlaceId, randomServer, LocalPlayer)
        else
            -- Metode 2: Regular rejoin jika server hop gagal
            print("[Fish It Utility] Server hop failed, using regular rejoin...")
            TeleportService:Teleport(game.PlaceId, LocalPlayer)
        end
    end)
    
    if not success then
        warn("[Fish It Utility] Rejoin failed:", err)
        -- Metode darurat: Force disconnect dan reconnect
        LocalPlayer:Kick("Auto Rejoin - Reconnecting...")
    end
end

-- Fungsi untuk auto execute script
local function autoExecuteScript()
    if AUTO_EXECUTE then
        print("[Fish It Utility] Auto-execute enabled")
    end
end

-- Main loop dengan interval lebih panjang
local function startAutoRejoin()
    print("=================================")
    print("[Fish It Utility] Started!")
    print("[Fish It Utility] Auto Server Hop: ON")
    print("[Fish It Utility] Interval: " .. REJOIN_INTERVAL .. " seconds (" .. math.floor(REJOIN_INTERVAL/60) .. " minutes)")
    print("=================================")
    
    autoExecuteScript()
    
    -- Loop dengan interval 3 menit
    spawn(function()
        while true do
            wait(REJOIN_INTERVAL)
            rejoinGame()
        end
    end)
end

-- Handle disconnections
game:GetService("GuiService").ErrorMessageChanged:Connect(function()
    print("[Fish It Utility] Error detected, attempting rejoin...")
    wait(2)
    rejoinGame()
end)

-- Proteksi anti-kick yang lebih baik
local mt = getrawmetatable(game)
local oldNamecall = mt.__namecall
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}
    
    if method == "Kick" then
        print("[Fish It Utility] Kick detected, rejoining...")
        wait(1)
        rejoinGame()
        return wait(9e9) -- Prevent kick
    end
    
    if method == "TeleportToPlaceInstance" or method == "Teleport" then
        -- Allow teleport but log it
        print("[Fish It Utility] Teleport detected")
    end
    
    return oldNamecall(self, ...)
end)

setreadonly(mt, true)

-- UI Notification yang lebih informatif
local function createNotification(title, text, duration)
    game.StarterGui:SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = duration or 5,
        Icon = "rbxassetid://6031302931"
    })
end

-- Tampilkan notifikasi startup
createNotification(
    "Fish It Utility",
    "Server hop aktif! Hop setiap " .. math.floor(REJOIN_INTERVAL/60) .. " menit untuk farming optimal",
    7
)

-- Command untuk manual rejoin (ketik di chat)
LocalPlayer.Chatted:Connect(function(msg)
    if msg:lower() == "/rejoin" or msg:lower() == "/hop" then
        createNotification("Fish It Utility", "Manual rejoin initiated...", 3)
        wait(1)
        rejoinGame()
    end
end)

-- Jalankan utility
startAutoRejoin()

print("[Fish It Utility] Type /rejoin or /hop in chat for manual server hop!")
